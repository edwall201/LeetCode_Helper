import { useState } from 'react';

async function analyze(question, answer, { setResult }) {
  if (!question?.trim() || !answer?.trim()) {
    alert("Please enter both a question and an answer");
    return;
  }

  const res = await fetch("http://127.0.0.1:8000/api/grade", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      "question": question,
      "answer": answer,
    })
  })
  
  
  if (!res.ok) {
    throw new Error("Failed to grade solution");
  }
  
  console.log(res); 

  const data = res.json();
  const time = new Date().toISOString();
  const record = {
    time,
    logic: data.logic,
    efficiency: data.efficiency,
    readability: data.readability,
    question,
    answer,
  }
  setResult(record);
}


function InputPanel({ question, setQuestion, answer, setAnswer, onAnalyze}) {
  return (
    <div className="w-full flex flex-col items-center">
      <textarea
        style={{ height: '18rem' }}
        className="w-2/3 p-5 border rounded mb-8 resize-none text-2xl placeholder:text-2xl placeholder:text-gray-400"
        value={question}
        onChange={(e) => setQuestion(e.target.value)}
        placeholder="LeetCode question title or summary"
      />

      <textarea
        style={{ height: '18rem' }}
        className="w-2/3 p-5 border rounded mb-8 resize-none text-2xl placeholder:text-2xl placeholder:text-gray-400"
        value={answer}
        onChange={(e) => setAnswer(e.target.value)}
        placeholder={`Paste your answer / code here.\nInclude comments or complexity notes if you have them.`}
      />

      <button
        onClick={onAnalyze}
        className="px-10 py-3 bg-indigo-600 text-white rounded hover:bg-indigo-700 mb-10 text-lg"
      >
        Analyze
      </button>
    </div>
  );
}

function ResultPanel({ result }) {
  return (
     <div className="w-full flex flex-col items-center mb-10">
      <div className="w-2/3 text-left max-h-[500px] overflow-y-auto">
        <h2 className="font-semibold mb-4 text-xl text-center">Categories (scored)</h2>
        {result ? (
          <div className="p-6 border rounded bg-gray-50 text-base">
            <div className="text-gray-600 text-center">
              Time â€¢ {new Date(result.time).toLocaleString()}
            </div>
            <div className="mt-3 text-center">
              Logic: <strong>{result.logic}</strong>/100
            </div>
            <div className="text-center">
              Efficiency: <strong>{result.efficiency}</strong>/100
            </div>
            <div className="text-center">
              Readability: <strong>{result.readability}</strong>/100
            </div>
          </div>
        ) : (
          <div className="text-gray-500 text-base text-center">
            Press <strong>Analyze</strong> to evaluate your answer.
          </div>
        )}
      </div>
    </div> 
  );
}

export default function App() {
  const [question, setQuestion] = useState('');
  const [answer, setAnswer] = useState('');
  const [result, setResult] = useState(null);

  return (
    <div className="min-h-screen bg-gray-50 flex justify-center overflow-y-auto">
      <div className="flex flex-col items-center justify-start w-full max-w-7xl bg-white shadow-lg rounded-2xl p-12 text-center">
        <h1 className="text-5xl font-bold mb-12 mt-6">LeetCode Helper</h1>

        {/* Question and Answer inputs */}
        <InputPanel 
          question = {question}
          setQuestion = {setQuestion}
          answer = {answer}
          setAnswer = {setAnswer}
          onAnalyze = {() => analyze(question, answer, { setResult })}
        />
        {/* Results Section */}
        <ResultPanel
          result = {result}
        />
      </div>
    </div>
  );
}
